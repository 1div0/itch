{"version":3,"sources":["metal/api.coffee"],"names":[],"mappings":"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","file":"metal/api.js","sourceRoot":"/source/","sourcesContent":["\nrequest = require \"request-promise\"\n\nPromise = require \"bluebird\"\nImmutable = require \"seamless-immutable\"\n\n##\n# Wrapper for the itch.io API\n##\nclass Client\n  root_url: \"https://itch.io/api/1\"\n  # root_url: \"http://localhost.com:8080/api/1\"\n\n  request: (method, path, data) ->\n    uri = \"#{@root_url}#{path}\"\n    options = { method, uri }\n\n    switch method.toLowerCase()\n      when 'get'\n        options.qs = data\n      when 'post'\n        options.form = data\n\n    request(options).then(JSON.parse).then (res) =>\n      if res.errors\n        Promise.reject Immutable res.errors\n      else\n        Immutable res\n\n  login_key: (key) =>\n    @request \"post\", \"/#{key}/me\", {\n      source: \"desktop\"\n    }\n\n  login_with_password: (username, password) ->\n    @request \"post\", \"/login\", {\n      username: username\n      password: password\n      source: \"desktop\"\n    }\n\n##\n# A user, according to the itch.io API\n##\nclass User\n  constructor: (@client, @key) ->\n    throw Error \"Missing key for user\" unless @key\n\n  request: (method, url, params) ->\n    url = \"/#{@key}#{url}\"\n    @client.request method, url, params\n\n  my_games: ->\n    @request \"get\", \"/my-games\"\n\n  my_owned_keys: ->\n    @request \"get\", \"/my-owned-keys\"\n\n  my_claimed_keys: ->\n    @request \"get\", \"/my-claimed-keys\"\n\n  me: ->\n    @request \"get\", \"/me\"\n\n  my_collections: ->\n    @request \"get\", \"/my-collections\"\n\n  download_key_uploads: (download_key_id) ->\n    @request \"get\", \"/download-key/#{download_key_id}/uploads\"\n\n  download_upload_with_key: (download_key_id, upload_id)->\n    @request \"get\", \"/download-key/#{download_key_id}/download/#{upload_id}\"\n\n  game_uploads: (game_id) ->\n    @request \"get\", \"/game/#{game_id}/uploads\"\n\n  download_upload: (upload_id) ->\n    @request \"get\", \"/upload/#{upload_id}/download\"\n\nclient = new Client\n\nmodule.exports = {\n  client\n  Client\n  User\n}\n\n"]}